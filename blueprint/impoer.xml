<mxfile host="app.diagrams.net" modified="2025-08-13T08:15:00.000Z" agent="Gemini" version="24.7.5" type="device">
  <diagram id="final-diagram" name="最終修正版シーケンス図">
    <mxGraphModel dx="2188" dy="1357" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1654" pageHeight="2336" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="100" value="Webアプリ" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;" parent="1" vertex="1">
          <mxGeometry x="80" y="40" width="100" height="1900" as="geometry" />
        </mxCell>
        <mxCell id="101" value="slackアプリ" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;" parent="1" vertex="1">
          <mxGeometry x="300" y="40" width="100" height="1900" as="geometry" />
        </mxCell>
        <mxCell id="102" value="ラズパイ" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;" parent="1" vertex="1">
          <mxGeometry x="520" y="40" width="100" height="1900" as="geometry" />
        </mxCell>
        <mxCell id="103" value="サーバー" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;" parent="1" vertex="1">
          <mxGeometry x="740" y="40" width="100" height="1900" as="geometry" />
        </mxCell>
        <mxCell id="104" value="DB" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;" parent="1" vertex="1">
          <mxGeometry x="960" y="40" width="100" height="1900" as="geometry" />
        </mxCell>
        <mxCell id="200" value="【シナリオ1：ユーザー新規登録と顔情報登録】" style="text;html=1;align=left;fontSize=14;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="80" y="60" width="410" height="30" as="geometry" />
        </mxCell>
        <mxCell id="201" value="" style="shape=umlActivation;whiteSpace=wrap;html=1;" parent="100" vertex="1">
          <mxGeometry y="70" width="10" height="340" as="geometry" />
        </mxCell>
        <mxCell id="202" value="" style="shape=umlActivation;whiteSpace=wrap;html=1;" parent="103" vertex="1">
          <mxGeometry y="70" width="10" height="340" as="geometry" />
        </mxCell>
        <mxCell id="203" value="新規ユーザー登録フォーム入力・送信" style="html=1;endArrow=block;" parent="1" source="201" target="202" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="204" value="" style="shape=umlActivation;whiteSpace=wrap;html=1;" parent="104" vertex="1">
          <mxGeometry y="110" width="10" height="50" as="geometry" />
        </mxCell>
        <mxCell id="205" value="ユーザーテーブル登録" style="html=1;endArrow=block;" parent="1" source="202" target="204" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="206" value="登録完了(200)" style="html=1;endArrow=open;dashed=1;" parent="1" source="202" target="201" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="207" value="顔写真アップロード" style="html=1;endArrow=block;" parent="1" source="201" target="202" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="208" value="" style="shape=umlActivation;whiteSpace=wrap;html=1;" parent="104" vertex="1">
          <mxGeometry y="260" width="10" height="50" as="geometry" />
        </mxCell>
        <mxCell id="209" value="顔特徴量を抽出" style="html=1;endArrow=block;" parent="1" source="202" target="202" edge="1">
          <mxGeometry x="-1" y="20" relative="1" as="geometry" />
        </mxCell>
        <mxCell id="210" value="顔特徴量をユーザーに紐づけ更新" style="html=1;endArrow=block;" parent="1" source="202" target="208" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="211" value="登録完了(200)" style="html=1;endArrow=open;dashed=1;" parent="1" source="202" target="201" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="300" value="【シナリオ2：管理者によるデバイス登録】" style="text;html=1;align=left;fontSize=14;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="80" y="470" width="410" height="30" as="geometry" />
        </mxCell>
        <mxCell id="301" value="" style="shape=umlActivation;whiteSpace=wrap;html=1;" parent="100" vertex="1">
          <mxGeometry y="440" width="10" height="140" as="geometry" />
        </mxCell>
        <mxCell id="302" value="" style="shape=umlActivation;whiteSpace=wrap;html=1;" parent="103" vertex="1">
          <mxGeometry y="440" width="10" height="140" as="geometry" />
        </mxCell>
        <mxCell id="303" value="ラズパイ登録 (device_id, seat_id) 送信" style="html=1;endArrow=block;" parent="1" source="301" target="302" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="304" value="" style="shape=umlActivation;whiteSpace=wrap;html=1;" parent="104" vertex="1">
          <mxGeometry y="480" width="10" height="40" as="geometry" />
        </mxCell>
        <mxCell id="305" value="デバイステーブル登録" style="html=1;endArrow=block;" parent="1" source="302" target="304" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="306" value="登録完了(200)" style="html=1;endArrow=open;dashed=1;" parent="1" source="302" target="301" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="400" value="【シナリオ3：ユーザーログイン】" style="text;html=1;align=left;fontSize=14;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="80" y="640" width="410" height="30" as="geometry" />
        </mxCell>
        <mxCell id="401" value="" style="shape=umlActivation;whiteSpace=wrap;html=1;" parent="100" vertex="1">
          <mxGeometry y="610" width="10" height="160" as="geometry" />
        </mxCell>
        <mxCell id="402" value="" style="shape=umlActivation;whiteSpace=wrap;html=1;" parent="103" vertex="1">
          <mxGeometry y="610" width="10" height="160" as="geometry" />
        </mxCell>
        <mxCell id="403" value="ログイン情報(ID, Pass)送信" style="html=1;endArrow=block;" parent="1" source="401" target="402" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="404" value="" style="shape=umlActivation;whiteSpace=wrap;html=1;" parent="104" vertex="1">
          <mxGeometry y="650" width="10" height="50" as="geometry" />
        </mxCell>
        <mxCell id="405" value="ユーザー情報照合" style="html=1;endArrow=block;" parent="1" source="402" target="404" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="406" value="認証OK/NG" style="html=1;endArrow=open;dashed=1;" parent="1" source="404" target="402" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="407" value="認証トークン発行・返却" style="html=1;endArrow=open;dashed=1;" parent="1" source="402" target="401" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="500" value="【シナリオ4：顔認証による座席ステータス更新】" style="text;html=1;align=left;fontSize=14;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="80" y="830" width="410" height="30" as="geometry" />
        </mxCell>
        <mxCell id="501" value="loop [10分ごと]" style="shape=umlFrame;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="500" y="870" width="580" height="620" as="geometry" />
        </mxCell>
        <mxCell id="502" value="" style="shape=umlActivation;whiteSpace=wrap;html=1;" parent="102" vertex="1">
          <mxGeometry y="860" width="10" height="600" as="geometry" />
        </mxCell>
        <mxCell id="503" value="" style="shape=umlActivation;whiteSpace=wrap;html=1;" parent="103" vertex="1">
          <mxGeometry y="860" width="10" height="600" as="geometry" />
        </mxCell>
        <mxCell id="504" value="顔写真送信" style="html=1;endArrow=block;" parent="1" source="502" target="503" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="505" value="" style="shape=umlActivation;whiteSpace=wrap;html=1;" parent="104" vertex="1">
          <mxGeometry y="900" width="10" height="80" as="geometry" />
        </mxCell>
        <mxCell id="506" value="DBから全ユーザーの顔特徴量を取得" style="html=1;endArrow=block;" parent="1" source="503" target="505" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="507" value="顔特徴量リストを返却" style="html=1;endArrow=open;dashed=1;" parent="1" source="505" target="503" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="508" value="サーバー内で顔認証" style="html=1;endArrow=block;" parent="1" source="503" target="503" edge="1">
          <mxGeometry x="-1" y="20" relative="1" as="geometry" />
        </mxCell>
        <mxCell id="509" value="alt" style="shape=umlFrame;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="720" y="1080" width="350" height="380" as="geometry" />
        </mxCell>
        <mxCell id="510" value="[認証成功]" style="text;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="730" y="1105" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="511" value="seatテーブル更新 (着席, user_id)" style="html=1;endArrow=block;" parent="1" source="503" target="505" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="512" value="Slackステータス更新 (在席中)" style="html=1;endArrow=block;" parent="1" source="503" target="101" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="513" value="200 OK" style="html=1;endArrow=open;dashed=1;" parent="1" source="503" target="502" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="514" value="" style="line;strokeWidth=1;dashed=1;" parent="1" vertex="1">
          <mxGeometry x="720" y="1260" width="350" height="10" as="geometry" />
        </mxCell>
        <mxCell id="515" value="[認証失敗 (not found)]" style="text;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="730" y="1275" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="516" value="seatテーブル更新 (離席)" style="html=1;endArrow=block;" parent="1" source="503" target="505" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="517" value="Slackステータスをクリア" style="html=1;endArrow=block;" parent="1" source="503" target="101" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="518" value="401 Unauthorized" style="html=1;endArrow=open;dashed=1;" parent="1" source="503" target="502" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>